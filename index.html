<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VALERI Dashboard - Wirtschaftlichkeitsanalyse</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js for Graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- html2canvas for Export -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>

<body>
    <div class="background-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <main class="container">
        <header style="text-align: center;">
            <h1>VALERI Dashboard</h1>
            <p class="subtitle">Bewertung von energiebezogenen Investitionen (DIN EN 17463)</p>
        </header>

        <div class="dashboard-grid">
            <section class="input-section glass-card">
                <h2>Projektparameter & Szenarien</h2>
                <form id="valeri-form">

                    <!-- WACC / Interest Rate Section -->
                    <div class="section-group">
                        <h3>1. Zinssatzermittlung (WACC)</h3>
                        <div class="input-grid wacc-grid">
                            <div class="grid-header">Parameter</div>
                            <div class="grid-header" style="color:var(--primary-color)">Wahrscheinlicher Fall</div>
                            <div class="grid-header" style="color:#f87171">Worst Case</div>
                            <div class="grid-header" style="color:#4ade80">Best Case</div>

                            <!-- Equity Ratio -->
                            <div class="grid-label">
                                Eigenkapitalanteil (S<sub>eq</sub>) [%]
                            </div>
                            <div class="grid-input full-width">
                                <input type="number" id="equity-ratio" value="50" min="0" max="100" step="1">
                            </div>

                            <!-- Debt Ratio (Calculated) -->
                            <div class="grid-label">
                                Fremdkapitalanteil (S<sub>debt</sub>) [%]
                            </div>
                            <div class="grid-input full-width">
                                <input type="number" id="debt-ratio" value="50" disabled>
                            </div>

                            <!-- Cost of Equity -->
                            <div class="grid-label">
                                Eigenkapitalzinssatz (r<sub>eq</sub>) [%]
                            </div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="req"
                                    data-case="likely" value="7.0" step="0.1"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="req"
                                    data-case="worst" value="8.5" step="0.1"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="req"
                                    data-case="best" value="5.5" step="0.1"></div>

                            <!-- Cost of Debt -->
                            <div class="grid-label">
                                Fremdkapitalzinssatz (r<sub>debt</sub>) [%]
                            </div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="rdebt"
                                    data-case="likely" value="6.0" step="0.1"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="rdebt"
                                    data-case="worst" value="11.0" step="0.1"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="rdebt"
                                    data-case="best" value="3.0" step="0.1"></div>

                            <!-- WACC Result -->
                            <div class="grid-label highlight">
                                <strong>Kalkulationszinssatz (r) [%]</strong>
                            </div>
                            <div class="grid-input highlight"><span id="wacc-likely">6.50%</span></div>
                            <div class="grid-input highlight"><span id="wacc-worst">9.75%</span></div>
                            <div class="grid-input highlight"><span id="wacc-best">4.25%</span></div>
                        </div>
                    </div>

                    <!-- Scenario Parameters Section -->
                    <div class="section-group">
                        <h3>2. Szenarioparameter</h3>
                        <div class="input-grid scenario-grid">
                            <div class="grid-header">Parameter</div>
                            <div class="grid-header">Wahrscheinlicher Fall</div>
                            <div class="grid-header">Worst Case</div>
                            <div class="grid-header">Best Case</div>

                            <!-- Investment -->
                            <div class="grid-label">Investition (â‚¬)</div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="invest"
                                    data-case="likely" value="60000"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="invest"
                                    data-case="worst" value="85000"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="invest"
                                    data-case="best" value="50000"></div>

                            <!-- Grant/Subsidy -->
                            <div class="grid-label">FÃ¶rderung (t=0) (â‚¬)</div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="subsidy"
                                    data-case="likely" value="0" min="0"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="subsidy"
                                    data-case="worst" value="0" min="0"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="subsidy"
                                    data-case="best" value="5000" min="0"></div>

                            <!-- Annual Operating Costs -->
                            <div class="grid-label">JÃ¤hrliche Betriebskosten (â‚¬/a)</div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="ops_cost"
                                    data-case="likely" value="1000" min="0"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="ops_cost"
                                    data-case="worst" value="1500" min="0"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="ops_cost"
                                    data-case="best" value="800" min="0"></div>

                            <!-- Other Annual Revenues -->
                            <div class="grid-label">Sonstige jÃ¤hrl. ErtrÃ¤ge (â‚¬/a)</div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="other_rev"
                                    data-case="likely" value="0" min="0"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="other_rev"
                                    data-case="worst" value="0" min="0"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="other_rev"
                                    data-case="best" value="0" min="0"></div>

                            <!-- Energy Savings -->
                            <div class="grid-label">JÃ¤hrliche Energieeinsparung (kWh/a)</div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="savings"
                                    data-case="likely" value="150000"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="savings"
                                    data-case="worst" value="100000"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="savings"
                                    data-case="best" value="175000"></div>

                            <!-- Energy Price Increase -->
                            <div class="grid-label">Energiepreissteigerung (%/a)</div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="p_inc"
                                    data-case="likely" value="3.0" step="0.1"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="p_inc"
                                    data-case="worst" value="1.5" step="0.1"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="p_inc"
                                    data-case="best" value="4.5" step="0.1"></div>

                            <!-- Service Price Increase -->
                            <div class="grid-label">Preissteigerung Dienstl. (%/a)</div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="s_inc"
                                    data-case="likely" value="2.0" step="0.1"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="s_inc"
                                    data-case="worst" value="1.5" step="0.1"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="s_inc"
                                    data-case="best" value="3.0" step="0.1"></div>

                            <!-- Lifetime -->
                            <div class="grid-label">Laufzeit (Jahre)</div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="life"
                                    data-case="likely" value="15" max="15"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="life"
                                    data-case="worst" value="8" max="15"></div>
                            <div class="grid-input"><input type="number" class="scenario-input" data-param="life"
                                    data-case="best" value="15" max="15"></div>
                        </div>
                    </div>

                    <!-- Common Parameters -->
                    <div class="section-group">
                        <h3>3. Gemeinsame Parameter</h3>
                        <div class="form-group" style="max-width: 300px;">
                            <label for="price">Basis-Energiepreis (â‚¬/kWh)</label>
                            <input type="number" id="base-price" required min="0" step="0.0001" value="0.20">
                        </div>
                    </div>

                    <div class="form-actions" style="display:flex; flex-wrap:wrap; gap:1rem;">
                        <button type="submit" class="btn-primary" style="flex:2;">Berechnen</button>
                        <button type="button" id="reset-btn" class="btn-secondary" style="flex:1;">ZurÃ¼cksetzen</button>

                        <!-- JSON Import/Export -->
                        <div style="flex:1; display:flex; gap:0.5rem;">
                            <button type="button" class="btn-secondary" onclick="exportParametersToJSON()"
                                title="Parameter speichern">ðŸ’¾ Speichern</button>
                            <button type="button" class="btn-secondary"
                                onclick="document.getElementById('json-upload').click()" title="Parameter laden">ðŸ“‚
                                Laden</button>
                            <input type="file" id="json-upload" style="display:none" accept=".json"
                                onchange="importParametersFromJSON(event)">
                        </div>
                    </div>
                </form>
            </section>

            <section class="results-section">
                <!-- Comparison Table -->
                <div class="glass-card result-card full-width">
                    <h3>Szenario-Vergleich</h3>
                    <div class="table-responsive">
                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>Metrik</th>
                                    <th style="color:var(--primary-color)">Wahrscheinlicher Fall</th>
                                    <th style="color:#f87171">Worst Case</th>
                                    <th style="color:#4ade80">Best Case</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Kapitalwert (NPV)</td>
                                    <td class="result-value" id="res-npv-likely">--</td>
                                    <td class="result-value" id="res-npv-worst">--</td>
                                    <td class="result-value" id="res-npv-best">--</td>
                                </tr>
                                <tr>
                                    <td>Amortisationszeit</td>
                                    <td id="res-payback-likely">--</td>
                                    <td id="res-payback-worst">--</td>
                                    <td id="res-payback-best">--</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="kpi-nav-container"
                    style="display: none; flex-direction: row; flex-wrap: wrap; justify-content: center; gap: 1rem; margin: 1rem 0;">
                    <button class="btn-primary" onclick="window.location.href='metric_comparison.html'">
                        ðŸ“ˆ Struktur-Analyse
                    </button>
                    <button class="btn-primary" onclick="window.location.href='npv_curve.html'">
                        ðŸ“ˆ Kapitalwert-Verlauf
                    </button>
                    <button class="btn-primary" id="btn-open-kpi" onclick="window.location.href='kpi_dashboard.html'">
                        ðŸ“Š Kapitalwert-KPI
                    </button>
                    <button class="btn-primary" onclick="exportCashFlowsToCSV()">
                        ðŸ’¾ Cashflows (CSV)
                    </button>
                </div>

                <div class="glass-card chart-card collapsible-card">
                    <div class="card-header-toggle" onclick="toggleSection(this)"
                        style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                        <h3>Zahlungsstrom (Wahrscheinlicher Fall)</h3>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    <div class="chart-container card-content" style="display: none;">
                        <div id="cashflow-table-container-likely"></div>
                    </div>
                </div>

                <div class="glass-card chart-card collapsible-card">
                    <div class="card-header-toggle" onclick="toggleSection(this)"
                        style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="color:#f87171;">Zahlungsstrom (Worst Case)</h3>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    <div class="chart-container card-content" style="display: none;">
                        <div id="cashflow-table-container-worst"></div>
                    </div>
                </div>

                <div class="glass-card chart-card collapsible-card">
                    <div class="card-header-toggle" onclick="toggleSection(this)"
                        style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="color:#4ade80;">Zahlungsstrom (Best Case)</h3>
                        <span class="toggle-icon">â–¼</span>
                    </div>
                    <div class="chart-container card-content" style="display: none;">
                        <div id="cashflow-table-container-best"></div>
                    </div>
                </div>
            </section>
        </div>
    </main>
    <script src="script.js"></script>
</body>

</html>